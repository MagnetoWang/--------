## 说明

- 描述一个推荐系统的实现思路



[TOC]



## 系统组成

### 用户行为收集

- 解析用户访问日志
- 收集埋点

### 行为日志解析

- 定时批量处理
- Mini-Batch
- 逐条处理

### 推荐算法

- 内容相似
- 关联规则
- 协同过滤-用户和事务
- 主题模型
- 逻辑回归

### 元数据索引

- 新闻
- 视频
- 商品

### 用户画像仓库

- 用户长期兴趣标签
- 用户短期兴趣标签
- 热门兴趣标签

### 用户推荐服务

- 获取用户兴趣标签
- 获取相关元数据
- 处理实际业务需求
- 排序策略

### 终端展示

- just showing what users want to



### 用户行为收集实现

- 定义好数据表
  - remote_addr：客户端IP地址
  - remote_user：客户端的用户名称
  - time_local：访问时间和地区
  - request：请求的URL，确定访问网站的逻辑
  - status：响应状态
  - body_bytes_sent：客户端发送的文件主体内容大小
  - http_refer：记录用户从哪个链接跳转的
  - http_user_agent：记录用户使用代理情况
  - http_x_forwarded_for：通过代理服务器记录客户端IP



### 行为日志解析实现

- 主要是延迟问题
- 到底是批量处理
- 还是一条一条处理
- 要根据业务来看

### 推荐算法实现

- 难点是如何将业务数据，放到算法公式中，进行计算然后获得结果
- 最后直接看实现的代码，就是demo。需要有经验



### 元数据索引

- 对我们的产品内容进行索引
- 不是用户索引

### 用户画像数据仓库实现

- 标签
- 权值
- 数据的划分：根据更改信息的频率
  - 静态
  - 动态



## 系统用户画像的更新

- 5秒的延迟，系统算是比较合格
- ES负责新闻索引库
- Mongo负责用户长期兴趣标签
- Redis负责用户短期兴趣标签
- Kafka负责信息流的管道
- Spark 和 Storm负责信息的实时计算
- Fork/Join负责短期兴趣标签更新